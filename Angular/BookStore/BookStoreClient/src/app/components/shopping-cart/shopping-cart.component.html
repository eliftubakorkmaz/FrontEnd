<div class="card mt-3">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5>{{ 'shoppingCartPage' | translate}}</h5>
        <ul class="d-flex gap-2" style="list-style-type: none;">
            <li routerLink="/">{{'Home Page' | translate}}</li>
            <li>/</li>
            <li routerLink="/shopping-cart">{{'shoppingCartPage' | translate}}</li>
        </ul>
    </div>
</div>

<h1 class="alert alert-danger text-center" *ngIf="shopping.shoppingCarts.length === 0">
    {{'noBooksInShoppingCart' | translate}}
</h1>

<div class="row mt-4" *ngIf="shopping.shoppingCarts.length > 0">
    <div class="col-lg-9 col-12">
        <div class="card">
            <div class="card mt-1" *ngFor="let s of shopping.shoppingCarts let i = index" style="position: relative;">
                <div class="row">
                    <div class="col-2 text-center">
                        <img [src]="s.coverImageUrl" alt="" class="card-image">
                    </div>
                    <div class="col-lg-4 col-10">
                        <div class="form-group">
                            <b>{{'bookName' | translate }}</b>: {{s.title}}
                        </div>
                        <div class="form-group">
                            <b>{{'author' | translate }}</b>: {{s.author}}
                        </div>
                        <div class="form-group">
                            <b>{{'summary' | translate }}</b>: {{s.summary}}
                        </div>
                    </div>
                    <div class="col-lg-3 col-12">
                        <div>
                            <button class="btn btn-danger" (click)="shopping.changeBookQuantityInShoppingCart(s.id,s.quantity-1)">-</button>
                            <p [innerHtml]="s.quantity" class="alert alert-warning"></p>
                            <button class="btn btn-success" (click)="shopping.changeBookQuantityInShoppingCart(s.id,s.quantity+1)">+</button>
                        </div>
                    </div>
                    <div class="col-lg-3 col-12 text-center d-flex justify-content-center">
                        <h5>{{s.price.value | trCurrency }} {{s.price.currency}}</h5>
                    </div>
                    <i class="fa fa-trash trash" (click)="shopping.removeByIndex(i)"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-12">
        <div class="card mt-1" *ngFor="let p of shopping.prices">
            <div class="form-group">
                <h1 class="alert alert-danger text-center">
                    {{shopping.total | trCurrency }} â‚º
                </h1>
            </div>
            <div class="form-group">
                <button data-bs-toggle="modal" data-bs-target="#paymentModal" class="btn btn-danger w-100">{{'payment.pay' | translate}}</button>
            </div>
        </div>
    </div>
</div>

  <!-- Modal -->
  <div class="modal fade" id="paymentModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="paymentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="paymentModalLabel">{{'payment.title' | translate}}</h1>
          <button type="button" class="btn-close" id="paymentModalCloseBtn" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <ul class="nav nav-tabs">
                <li class="nav-item">
                  <a class="nav-link" (click)="changeTab(1)" [ngClass]="selectedTab === 1 ? 'active' : ''">{{'payment.buyer.title' | translate}}</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" (click)="changeTab(2)" [ngClass]="selectedTab === 2 ? 'active' : ''">{{'payment.address' | translate}}</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" (click)="changeTab(3)" [ngClass]="selectedTab === 3 ? 'active' : ''">{{'payment.creditCart.title' | translate}}</a>
                </li>
              </ul>
            
              <!-- Buyer -->
              <div *ngIf="selectedTab === 1" class="mt-1">
                <form #buyerForm="ngForm" autocomplete="off">
                    <div class="row mt-3">
                        <!-- Name Surname -->
                        <div class="col-lg-6 col-12">
                            <div class="form-group">
                                <label for="name">{{'payment.buyer.name' | translate}}</label>
                                <input type="text" [(ngModel)]="request.buyer.name" name="buyerName" class="form-control">
                            </div>
                        </div>
                        <div class="col-lg-6 col-12">
                            <div class="form-group">
                                <label for="surname">{{'payment.buyer.surname' | translate}}</label>
                                <input type="text" [(ngModel)]="request.buyer.surname" name="buyerSurname" class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-lg-4 col-12">
                            <div class="form-group">
                                <label for="identityNumber">{{'payment.buyer.identityNumber' | translate}}</label>
                                <input type="text" [(ngModel)]="request.buyer.surname" name="buyerIdentityNumber" class="form-control" maxlength="11">
                            </div>
                        </div>
                        <div class="col-lg-4 col-12">
                            <div class="form-group mt-1">
                                <label for="email">{{'payment.buyer.email' | translate}}</label>
                                <input type="email" [(ngModel)]="request.buyer.surname" name="buyerEmail" class="form-control">
                            </div>
                        </div>
                        <div class="col-lg-4 col-12">
                            <div class="form-group mt-1">
                                <label for="gsmNumber">{{'payment.buyer.gsmNumber' | translate}}</label>
                                <input type="number" [(ngModel)]="request.buyer.surname" name="buyerGsmNumber" class="form-control">
                            </div>
                        </div>
                    </div>
                </form>
              </div>

              <!-- Address -->
              <div *ngIf="selectedTab === 2">
                <p class="mt-3 alert alert-info">{{'payment.shippingAddress.title' | translate}}</p>
                <!-- Shipping -->
                <form shippingAddressForm="ngForm" autocomplete="off">
                    <div class="row mt-3">
                        <!-- Country City Zip Code -->
                        <div class="col-lg-4 col-12">
                            <div class="form-group mt-1">
                                <label for="shippingCountry">{{'payment.shippingAddress.country' | translate}}</label>
                                <select name="shippingCountry" class="form-control" [(ngModel)]="request.shippingAddress.country">
                                    <option *ngFor="let country of countries">{{country}}</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-4 col-12">
                            <div class="form-group mt-1">
                                <label for="shippingCity">{{'payment.shippingAddress.city' | translate}}</label>
                                <select name="shippingCity" class="form-control" [(ngModel)]="request.shippingAddress.city">
                                    <option *ngFor="let city of cities">{{city}}</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-4 col-12">
                            <div class="form-group mt-1">
                                <label for="shippingZipCode">{{'payment.shippingAddress.zipCode' | translate}}</label>
                                <input type="text" [(ngModel)]="request.shippingAddress.zipCode" name="shippingZipCode" class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <!-- Desc Contact Name -->
                        <div class="col-lg-6 col-12">
                            <div class="form-group mt-1">
                                <label for="shippingContactName">{{'payment.shippingAddress.contactName' | translate}}</label>
                                <input type="text" [(ngModel)]="request.shippingAddress.zipCode" name="shippingContactName" class="form-control">
                            </div>
                        </div>
                        <div class="col-lg-6 col-12">
                            <div class="form-group mt-1">
                                <label for="shippingDescription">{{'payment.shippingAddress.description' | translate}}</label>
                                <input type="text" [(ngModel)]="request.shippingAddress.zipCode" name="shippingDescription" class="form-control">
                            </div>
                        </div>
                    </div>
                    
                </form>
                <hr>
                <!-- Billing -->
                <div *ngIf="!isSameAddress">
                <p class="mt-3 alert alert-info">{{'payment.billingAddress.title' | translate}}</p>
                <form billingAddressForm="ngForm" autocomplete="off">
                    <div class="row mt-3">
                        <!-- Country City Zip Code -->
                        <div class="col-lg-4 col-12">
                            <div class="form-group mt-1">
                                <label for="billingCountry">{{'payment.billingAddress.country' | translate}}</label>
                                <select name="billingCountry" class="form-control" [(ngModel)]="request.billingAddress.country">
                                    <option *ngFor="let country of countries">{{country}}</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-4 col-12">
                            <div class="form-group mt-1">
                                <label for="billingCity">{{'payment.billingAddress.city' | translate}}</label>
                                <select name="billingCity" class="form-control" [(ngModel)]="request.billingAddress.city">
                                    <option *ngFor="let city of cities">{{city}}</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-lg-4 col-12">
                            <div class="form-group mt-1">
                                <label for="billingZipCode">{{'payment.billingAddress.zipCode' | translate}}</label>
                                <input type="text" [(ngModel)]="request.billingAddress.zipCode" name="billingZipCode" class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <!-- Desc Contact Name -->
                        <div class="col-lg-6 col-12">
                            <div class="form-group mt-1">
                                <label for="contactName">{{'payment.billingAddress.contactName' | translate}}</label>
                                <input type="text" [(ngModel)]="request.billingAddress.zipCode" name="billingContactName" class="form-control">
                            </div>
                        </div>
                        <div class="col-lg-6 col-12">
                            <div class="form-group mt-1">
                                <label for="description">{{'payment.billingAddress.description' | translate}}</label>
                                <input type="text" [(ngModel)]="request.billingAddress.zipCode" name="billingDescription" class="form-control">
                            </div>
                        </div>
                    </div>
                    
                </form>
                </div>

              
                <!-- Same Address -->
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" name="isSameAddress" checked [(ngModel)]="isSameAddress" (click)="changeIsSameAddress()">
                    <label class="form-check-label" for="isSameAddress">{{'payment.isSameAddress' | translate}}</label>
                </div>
              </div>

              <!-- CreditCart -->
              <div *ngIf="selectedTab === 3">
                <form creditCartForm="ngForm" autocomplete="off">
                    <!-- Card Holder -->
                    <div class="form-group mt-3">
                        <label for="cardHolderName">{{'payment.creditCart.cardHolderName' | translate}}</label>
                        <input type="text" class="form-control" name="cardHolderName" [(ngModel)]="request.paymentCard.cardHolderName">
                    </div>
                    <!-- Card Number -->
                    <div class="form-group mt-3">
                        <label for="cardNumber">{{'payment.creditCart.cardNumber' | translate}}</label>
                        <div class="row">
                            <div class="col-lg-2 col-3">
                                <input type="text" class="form-control" name="cardNumber1" id="cardNumber1" [(ngModel)]="cardNumber1" maxlength="4" (keyup)="gotoNextInputIf4Lenght('1', cardNumber1)">
                            </div>
                            <div class="col-lg-2 col-3">
                                <input type="text" class="form-control" name="cardNumber2" id="cardNumber2" [(ngModel)]="cardNumber2" maxlength="4" (keyup)="gotoNextInputIf4Lenght('2', cardNumber2)">
                            </div>
                            <div class="col-lg-2 col-3">
                                <input type="text" class="form-control" name="cardNumber3" id="cardNumber3" [(ngModel)]="cardNumber3" maxlength="4" (keyup)="gotoNextInputIf4Lenght('3', cardNumber3)">
                            </div>
                            <div class="col-lg-2 col-3">
                                <input type="text" class="form-control" name="cardNumber4" id="cardNumber4" [(ngModel)]="cardNumber4" maxlength="4" (keyup)="gotoNextInputIf4Lenght('4', cardNumber4)">
                            </div>
                        </div>
                    </div>
                    <!-- Card Expire Year Month cvc -->
                    <div class="row">
                        <div class="col-lg-5 col-12">
                            <div class="form-group mt-3">
                                <label for="expireMonth">{{'payment.creditCart.expireMonthAndYear' | translate}}</label>
                                <input type="month" class="form-control" id="expireMonthAndYear" name="expireMonth" [(ngModel)]="expireMonthAndYear" (keyup)="setExpireMonthAndYear()">
                            </div>
                        </div>

                        <div class="col-lg-2 col-12">
                            <div class="form-group mt-3">
                                <label for="cvc">{{'payment.creditCart.cvc' | translate}}</label>
                                <input type="text" class="form-control" name="cvc" id="cvc" [(ngModel)]="request.paymentCard.cvc" maxlength="3">
                            </div>
                        </div>
                    </div>
                </form>
              </div>
            </div>
        <div class="modal-footer">
          <button type="button" *ngIf="selectedTab > 1" class="btn btn-danger" (click)="changeTab(selectedTab - 1)" data-bs-dismiss="modal">{{'payment.prevBtn' | translate}}</button>
          <button type="button" *ngIf="selectedTab < 3" class="btn btn-primary" (click)="changeTab(selectedTab + 1)">{{'payment.nextBtn' | translate}}</button>
          <button type="button" *ngIf="selectedTab === 3" class="btn btn-success" (click)="payment()">{{'payment.completePaymentBtn' | translate}}</button>
        </div>
      </div>
    </div>
  </div>
